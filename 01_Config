/**
 * Configuration file for Campaign Report Google Apps Script
 * Multi-project support: Tricky, Moloco, and Regular
 * Complete threshold system with UX-friendly descriptions and ALL scenarios
 */

// Main spreadsheet ID (same for all projects)
var MAIN_SHEET_ID = '1sU3G0HYgv-xX1UGK4Qa_4jhpc7vndtRyKsojyVx9iaE';

// Shared Bearer Token for all projects
var SHARED_BEARER_TOKEN = 'eyJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJBcHBvZGVhbCIsImF1ZCI6WyJBcHBvZGVhbCJdLCJhZG1pbiI6dHJ1ZSwic3ViIjoyMzU4MzcsInR5cCI6ImFjY2VzcyIsImV4cCI6IjE4OTQ3MzY4MjAifQ.2TSLNElXLvfBxsOAJ4pYk106cSblF9kwkBreA-0Gs5DdRB3WFjo2aZzPKkxUYf8A95lbSpN55t41LJcWzatSCA';

// Settings storage property keys
var PROPERTY_KEYS = {
  TARGET_EROAS_TRICKY: 'TARGET_EROAS_TRICKY',
  TARGET_EROAS_MOLOCO: 'TARGET_EROAS_MOLOCO',
  TARGET_EROAS_REGULAR: 'TARGET_EROAS_REGULAR',
  AUTO_CACHE_ENABLED: 'AUTO_CACHE_ENABLED',
  AUTO_UPDATE_ENABLED: 'AUTO_UPDATE_ENABLED',
  GROWTH_THRESHOLDS_TRICKY: 'GROWTH_THRESHOLDS_TRICKY',
  GROWTH_THRESHOLDS_MOLOCO: 'GROWTH_THRESHOLDS_MOLOCO',
  GROWTH_THRESHOLDS_REGULAR: 'GROWTH_THRESHOLDS_REGULAR'
};

// Default target eROAS values
var DEFAULT_TARGET_EROAS = {
  TRICKY: 160,
  MOLOCO: 140,
  REGULAR: 140
};

// –ü–û–õ–ù–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Ä–æ–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
var DEFAULT_GROWTH_THRESHOLDS_BASE = {
  // üü¢ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
  healthyGrowth: { 
    minSpendChange: 10,    // +10% —Å–ø–µ–Ω–¥ –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞
    minProfitChange: 5     // +5% –ø—Ä–æ—Ñ–∏—Ç –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞
  },
  
  efficiencyImprovement: {
    maxSpendDecline: -5,   // –°–ø–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –¥–æ -5% –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    minProfitGrowth: 8     // –ü—Ä–æ—Ñ–∏—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏ –º–∏–Ω–∏–º—É–º –Ω–∞ +8%
  },
  
  // üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏  
  inefficientGrowth: { 
    minSpendChange: 0,     // –õ—é–±–æ–π —Ä–æ—Å—Ç/—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–ø–µ–Ω–¥–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏—Ç–∞
    maxProfitChange: -8    // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏—Ç–∞ -8%
  },
  
  // üü† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
  decliningEfficiency: { 
    minSpendStable: -2,    // –°–ø–µ–Ω–¥ —Å—Ç–∞–±–∏–ª–µ–Ω (–æ—Ç -2% –¥–æ +2%)
    maxSpendGrowth: 10,    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
    maxProfitDecline: -4,  // –ü–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏—Ç–∞ –æ—Ç -4% –¥–æ -7%
    minProfitDecline: -7   // –ú–∏–Ω–∏–º—É–º –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
  },
  
  // üîµ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è (Scaling Down)
  scalingDown: { 
    maxSpendChange: -15,   // –ë–æ–ª—å—à–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å–ø–µ–Ω–¥–∞
    // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
    efficient: {           // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ
      minProfitChange: 0   // –ü—Ä–æ—Ñ–∏—Ç —Å—Ç–∞–±–∏–ª–µ–Ω –∏–ª–∏ —Ä–∞—Å—Ç–µ—Ç
    },
    moderate: {            // –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ  
      maxProfitDecline: -10, // –ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç —É–º–µ—Ä–µ–Ω–Ω–æ
      minProfitDecline: -1   // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ
    },
    problematic: {         // –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ
      maxProfitDecline: -15  // –ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç —Å–∏–ª—å–Ω–æ
    }
  },
  
  // üü° –£–º–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
  moderateGrowth: {
    minSpendChange: 3,     // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞
    minProfitChange: 2,    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ—Ñ–∏—Ç–∞
    maxSpendChange: 9,     // –ú–∞–∫—Å–∏–º—É–º –¥–æ –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞
    maxProfitChange: 4     // –ú–∞–∫—Å–∏–º—É–º –¥–æ –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞
  },
  
  minimalGrowth: {
    maxSpendChange: 2,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞
    maxProfitChange: 1     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ—Ñ–∏—Ç–∞
  },
  
  // –°—Ü–µ–Ω–∞—Ä–∏–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–∞–¥–∞
  moderateDecline: {
    // –ë–∞–∑–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "—É–º–µ—Ä–µ–Ω–Ω–æ–≥–æ" —Å–ø–∞–¥–∞
    maxSpendDecline: -3,   // –î–æ -3% —Å—á–∏—Ç–∞–µ—Ç—Å—è —É–º–µ—Ä–µ–Ω–Ω—ã–º
    maxProfitDecline: -3,  // –î–æ -3% —Å—á–∏—Ç–∞–µ—Ç—Å—è —É–º–µ—Ä–µ–Ω–Ω—ã–º
    
    // –ü–æ—Ä–æ–≥–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —Å–ø–∞–¥–∞
    spendOptimization: {
      // –°–ø–µ–Ω–¥ –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ—Ñ–∏—Ç–∞ (—Ö–æ—Ä–æ—à–æ)
      spendRatio: 1.5      // –°–ø–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å –≤ 1.5 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
    },
    
    efficiencyDrop: {
      // –ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —Å–ø–µ–Ω–¥–∞ (–ø–ª–æ—Ö–æ) 
      profitRatio: 1.5     // –ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç –≤ 1.5 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
    },
    
    proportional: {
      // –û–±–∞ –ø–∞–¥–∞—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
      maxRatioDiff: 1.3    // –†–∞–∑–Ω–∏—Ü–∞ –Ω–µ –±–æ–ª–µ–µ —á–µ–º –≤ 1.3 —Ä–∞–∑–∞
    }
  },
  
  // ‚ö™ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
  stable: {
    maxAbsoluteChange: 2   // –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ ¬±2% —Å—á–∏—Ç–∞—é—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é
  },
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  proportionalDeclineRatio: 1.5 // –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–∞–¥–∞
};

var DEFAULT_GROWTH_THRESHOLDS = {
  TRICKY: JSON.parse(JSON.stringify(DEFAULT_GROWTH_THRESHOLDS_BASE)),
  MOLOCO: JSON.parse(JSON.stringify(DEFAULT_GROWTH_THRESHOLDS_BASE)),
  REGULAR: JSON.parse(JSON.stringify(DEFAULT_GROWTH_THRESHOLDS_BASE))
};

// UX-friendly threshold descriptions for settings UI - –†–ê–°–®–ò–†–ï–ù–ù–´–ï
var THRESHOLD_DESCRIPTIONS = {
  healthyGrowth: {
    title: "üü¢ Healthy Growth",
    description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–¥–æ—Ä–æ–≤—ã–π —Ä–æ—Å—Ç - –æ–±–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —Ä–∞—Å—Ç—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ",
    fields: {
      minSpendChange: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞ %",
      minProfitChange: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ—Ñ–∏—Ç–∞ %"
    },
    example: "Spend +15%, Profit +10% ‚Üí üü¢ Healthy Growth"
  },
  
  efficiencyImprovement: {
    title: "üü¢ Efficiency Improvement", 
    description: "–£–ª—É—á—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ - —Å–ø–µ–Ω–¥ –ø–∞–¥–∞–µ—Ç/—Å—Ç–∞–±–∏–ª–µ–Ω, –ø—Ä–æ—Ñ–∏—Ç —Ä–∞—Å—Ç–µ—Ç",
    fields: {
      maxSpendDecline: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ —Å–ø–µ–Ω–¥–∞ % (–º–æ–∂–Ω–æ –¥–æ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è)",
      minProfitGrowth: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ—Ñ–∏—Ç–∞ % –¥–ª—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è"
    },
    example: "Spend -10%, Profit +15% ‚Üí üü¢ Efficiency Improvement"
  },
  
  inefficientGrowth: {
    title: "üî¥ Inefficient Growth", 
    description: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ - –ø—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ —Ä–æ—Å—Ç–µ/—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–µ–Ω–¥–∞",
    fields: {
      minSpendChange: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞ % –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏—Ç–∞",
      maxProfitChange: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏—Ç–∞ %"
    },
    example: "Spend +15%, Profit -12% ‚Üí üî¥ Inefficient Growth"
  },
  
  decliningEfficiency: {
    title: "üü† Declining Efficiency",
    description: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ/—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–µ–Ω–¥–∞",
    fields: {
      minSpendStable: "–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ø–µ–Ω–¥–∞ –¥–ª—è '—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏'",
      maxSpendGrowth: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å–ø–µ–Ω–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è",
      maxProfitDecline: "–ù–∞—á–∞–ª–æ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏—Ç–∞ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è",
      minProfitDecline: "–ö–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (–¥–∞–ª—å—à–µ —É–∂–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)"
    },
    example: "Spend +8%, Profit -5% ‚Üí üü† Declining Efficiency"
  },
  
  scalingDown: {
    title: "üîµ Scaling Down",
    description: "–°—Ü–µ–Ω–∞—Ä–∏–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å–ø–µ–Ω–¥–∞",
    fields: {
      maxSpendChange: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å–ø–µ–Ω–¥–∞ %"
    },
    subcategories: {
      efficient: "–ü—Ä–æ—Ñ–∏—Ç —Å—Ç–∞–±–∏–ª–µ–Ω/—Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏ —Å–ø–µ–Ω–¥–∞",
      moderate: "–ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç —É–º–µ—Ä–µ–Ω–Ω–æ –ø—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏ —Å–ø–µ–Ω–¥–∞", 
      problematic: "–ü—Ä–æ—Ñ–∏—Ç –ø–∞–¥–∞–µ—Ç —Å–∏–ª—å–Ω–æ –ø—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏ —Å–ø–µ–Ω–¥–∞"
    },
    example: "Spend -25%, Profit +2% ‚Üí üîµ Scaling Down - Efficient"
  },
  
  moderateScenarios: {
    title: "üü° Moderate Scenarios",
    description: "–£–º–µ—Ä–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è - –µ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ",
    types: {
      moderateGrowth: "–û–±–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —Ä–∞—Å—Ç—É—Ç, –Ω–æ –Ω–µ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ø–æ—Ä–æ–≥–æ–≤ –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞",
      minimalGrowth: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",
      moderateDecline: "–£–º–µ—Ä–µ–Ω–Ω—ã–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏"
    },
    example: "Spend +8%, Profit +4% ‚Üí üü° Moderate Growth"
  }
};

/**
 * Get target eROAS for a project from script properties or default
 */
function getTargetEROAS(projectName) {
  var props = PropertiesService.getScriptProperties();
  var key = 'TARGET_EROAS_' + projectName;
  var value = props.getProperty(key);
  return value ? parseInt(value) : DEFAULT_TARGET_EROAS[projectName];
}

/**
 * Set target eROAS for a project
 */
function setTargetEROAS(projectName, value) {
  var props = PropertiesService.getScriptProperties();
  var key = 'TARGET_EROAS_' + projectName;
  props.setProperty(key, value.toString());
}

/**
 * Get growth thresholds for a project from script properties or default
 */
function getGrowthThresholds(projectName) {
  var props = PropertiesService.getScriptProperties();
  var key = 'GROWTH_THRESHOLDS_' + projectName;
  var value = props.getProperty(key);
  
  if (value) {
    try {
      return JSON.parse(value);
    } catch (e) {
      console.error('Error parsing growth thresholds for ' + projectName + ':', e);
      return DEFAULT_GROWTH_THRESHOLDS[projectName];
    }
  }
  
  return DEFAULT_GROWTH_THRESHOLDS[projectName];
}

/**
 * Set growth thresholds for a project
 */
function setGrowthThresholds(projectName, thresholds) {
  var props = PropertiesService.getScriptProperties();
  var key = 'GROWTH_THRESHOLDS_' + projectName;
  props.setProperty(key, JSON.stringify(thresholds));
}

/**
 * Reset growth thresholds to default for a project
 */
function resetGrowthThresholds(projectName) {
  var props = PropertiesService.getScriptProperties();
  var key = 'GROWTH_THRESHOLDS_' + projectName;
  props.deleteProperty(key);
}

/**
 * Get user-friendly threshold explanation for UI
 */
function getThresholdExplanation(thresholdType, projectName) {
  var desc = THRESHOLD_DESCRIPTIONS[thresholdType];
  var current = getGrowthThresholds(projectName)[thresholdType];
  
  if (!desc) return 'Unknown threshold type';
  
  var explanation = desc.title + '\n' + desc.description + '\n\n';
  
  if (desc.fields) {
    Object.keys(desc.fields).forEach(function(field) {
      var description = desc.fields[field];
      var value = typeof current === 'object' ? current[field] : current;
      explanation += '‚Ä¢ ' + description + ': ' + value + '%\n';
    });
  }
  
  explanation += '\nExample: ' + desc.example;
  return explanation;
}

/**
 * Get comprehensive status overview for a project - –û–ë–ù–û–í–õ–ï–ù–ù–´–ô
 */
function getProjectStatusOverview(projectName) {
  var thresholds = getGrowthThresholds(projectName);
  var targetROAS = getTargetEROAS(projectName);
  
  return 'üìä ' + projectName + ' STATUS OVERVIEW\n\n' +
    'üéØ Target eROAS: ' + targetROAS + '%\n\n' +
    
    'üü¢ –ü–û–ó–ò–¢–ò–í–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:\n' +
    '‚Ä¢ Healthy Growth: Spend >' + thresholds.healthyGrowth.minSpendChange + '% AND Profit >' + thresholds.healthyGrowth.minProfitChange + '%\n' +
    '‚Ä¢ Efficiency Improvement: Spend <' + thresholds.efficiencyImprovement.maxSpendDecline + '% AND Profit >' + thresholds.efficiencyImprovement.minProfitGrowth + '%\n\n' +
    
    'üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–¶–ï–ù–ê–†–ò–ò:\n' +
    '‚Ä¢ Inefficient Growth: Profit <' + thresholds.inefficientGrowth.maxProfitChange + '% (–ø—Ä–∏ –ª—é–±–æ–º —Ä–æ—Å—Ç–µ —Å–ø–µ–Ω–¥–∞)\n\n' +
    
    'üü† –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:\n' +
    '‚Ä¢ Declining Efficiency: Spend —Å—Ç–∞–±–∏–ª–µ–Ω/—Ä–∞—Å—Ç–µ—Ç, Profit –æ—Ç ' + thresholds.decliningEfficiency.maxProfitDecline + '% –¥–æ ' + thresholds.decliningEfficiency.minProfitDecline + '%\n\n' +
    
    'üîµ –°–û–ö–†–ê–©–ï–ù–ò–ï:\n' +
    '‚Ä¢ Scaling Down: Spend <' + thresholds.scalingDown.maxSpendChange + '%\n' +
    '  - Efficient: Profit ‚â•0%\n' +
    '  - Moderate: Profit –æ—Ç ' + thresholds.scalingDown.moderate.minProfitDecline + '% –¥–æ ' + thresholds.scalingDown.moderate.maxProfitDecline + '%\n' +
    '  - Problematic: Profit <' + thresholds.scalingDown.problematic.maxProfitDecline + '%\n\n' +
    
    'üü° –£–ú–ï–†–ï–ù–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:\n' +
    '‚Ä¢ Moderate Growth: Spend ' + thresholds.moderateGrowth.minSpendChange + '%-' + thresholds.moderateGrowth.maxSpendChange + '%, Profit ' + thresholds.moderateGrowth.minProfitChange + '%-' + thresholds.moderateGrowth.maxProfitChange + '%\n' +
    '‚Ä¢ Minimal Growth: Spend ‚â§' + thresholds.minimalGrowth.maxSpendChange + '%, Profit ‚â§' + thresholds.minimalGrowth.maxProfitChange + '%\n' +
    '‚Ä¢ Moderate Decline: –†–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —É–º–µ—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–∞–¥–∞\n\n' +
    
    '‚ö™ –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨:\n' +
    '‚Ä¢ Stable: –ò–∑–º–µ–Ω–µ–Ω–∏—è ‚â§¬±' + thresholds.stable.maxAbsoluteChange + '%';
}

// Project configurations with dynamic getters
function getTrickyTargetEROAS() { return getTargetEROAS('TRICKY'); }
function getMolocoTargetEROAS() { return getTargetEROAS('MOLOCO'); }
function getRegularTargetEROAS() { return getTargetEROAS('REGULAR'); }

function getTrickyGrowthThresholds() { return getGrowthThresholds('TRICKY'); }
function getMolocoGrowthThresholds() { return getGrowthThresholds('MOLOCO'); }
function getRegularGrowthThresholds() { return getGrowthThresholds('REGULAR'); }

var PROJECTS = {
  TRICKY: {
    SHEET_NAME: 'Tricky',
    API_URL: 'https://app.appodeal.com/graphql',
    TARGET_EROAS: getTrickyTargetEROAS,
    GROWTH_THRESHOLDS: getTrickyGrowthThresholds,
    BEARER_TOKEN: SHARED_BEARER_TOKEN,
    COMMENTS_CACHE_SHEET: 'CommentsCache_Tricky',
    API_CONFIG: {
      OPERATION_NAME: "RichStats",
      FILTERS: {
        USER: ["79950","127168","157350","150140","11628","233863","239157"],
        ATTRIBUTION_PARTNER: ["Stack"],
        ATTRIBUTION_NETWORK_HID: ["234187180623265792"],
        ATTRIBUTION_CAMPAIGN_SEARCH: "/tricky/i"
      },
      GROUP_BY: [
        { dimension: "INSTALL_DATE", timeBucket: "WEEK" },
        { dimension: "ATTRIBUTION_CAMPAIGN_HID" },
        { dimension: "APP" }
      ],
      MEASURES: [
        { id: "cpi", day: null }, 
        { id: "installs", day: null }, 
        { id: "ipm", day: null },
        { id: "spend", day: null }, 
        { id: "roas", day: 1 }, 
        { id: "e_arpu_forecast", day: 365 },
        { id: "e_roas_forecast", day: 365 },
        { id: "e_profit_forecast", day: 730 }
      ]
    }
  },
  
  MOLOCO: {
    SHEET_NAME: 'Moloco',
    API_URL: 'https://app.appodeal.com/graphql',
    TARGET_EROAS: getMolocoTargetEROAS,
    GROWTH_THRESHOLDS: getMolocoGrowthThresholds,
    BEARER_TOKEN: SHARED_BEARER_TOKEN,
    COMMENTS_CACHE_SHEET: 'CommentsCache_Moloco',
    API_CONFIG: {
      OPERATION_NAME: "RichStats",
      FILTERS: {
        USER: ["79950","127168","157350","150140","11628","233863","239157"],
        ATTRIBUTION_PARTNER: ["Stack"],
        ATTRIBUTION_NETWORK_HID: ["445856363109679104"],
        ATTRIBUTION_CAMPAIGN_SEARCH: null
      },
      GROUP_BY: [
        { dimension: "INSTALL_DATE", timeBucket: "WEEK" },
        { dimension: "ATTRIBUTION_CAMPAIGN_HID" },
        { dimension: "APP" }
      ],
      MEASURES: [
        { id: "cpi", day: null }, 
        { id: "installs", day: null }, 
        { id: "ipm", day: null },
        { id: "spend", day: null }, 
        { id: "roas", day: 1 }, 
        { id: "e_arpu_forecast", day: 365 },
        { id: "e_roas_forecast", day: 365 }, 
        { id: "e_profit_forecast", day: 730 }
      ]
    }
  },

  REGULAR: {
    SHEET_NAME: 'Regular',
    API_URL: 'https://app.appodeal.com/graphql',
    TARGET_EROAS: getRegularTargetEROAS,
    GROWTH_THRESHOLDS: getRegularGrowthThresholds,
    BEARER_TOKEN: SHARED_BEARER_TOKEN,
    COMMENTS_CACHE_SHEET: 'CommentsCache_Regular',
    API_CONFIG: {
      OPERATION_NAME: "RichStats",
      FILTERS: {
        USER: ["79950","127168","157350","150140","11628","233863","239157"],
        ATTRIBUTION_PARTNER: ["Stack"],
        ATTRIBUTION_NETWORK_HID: ["234187180623265792"],
        ATTRIBUTION_CAMPAIGN_SEARCH: "!/tricky/i"
      },
      GROUP_BY: [
        { dimension: "INSTALL_DATE", timeBucket: "WEEK" },
        { dimension: "ATTRIBUTION_CAMPAIGN_HID" },
        { dimension: "APP" }
      ],
      MEASURES: [
        { id: "cpi", day: null }, 
        { id: "installs", day: null }, 
        { id: "ipm", day: null },
        { id: "spend", day: null }, 
        { id: "roas", day: 1 }, 
        { id: "e_arpu_forecast", day: 365 },
        { id: "e_roas_forecast", day: 365 }, 
        { id: "e_profit_forecast", day: 730 }
      ]
    }
  }
};

// Current project (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
var CURRENT_PROJECT = 'TRICKY';

// Helper functions to get current project configuration
function getCurrentConfig() {
  return {
    SHEET_ID: MAIN_SHEET_ID,
    SHEET_NAME: PROJECTS[CURRENT_PROJECT].SHEET_NAME,
    API_URL: PROJECTS[CURRENT_PROJECT].API_URL,
    TARGET_EROAS: PROJECTS[CURRENT_PROJECT].TARGET_EROAS(),
    GROWTH_THRESHOLDS: PROJECTS[CURRENT_PROJECT].GROWTH_THRESHOLDS(),
    BEARER_TOKEN: PROJECTS[CURRENT_PROJECT].BEARER_TOKEN,
    COMMENTS_CACHE_SHEET: PROJECTS[CURRENT_PROJECT].COMMENTS_CACHE_SHEET
  };
}

function getCurrentApiConfig() {
  return PROJECTS[CURRENT_PROJECT].API_CONFIG;
}

function getProjectConfig(projectName) {
  if (!PROJECTS[projectName]) {
    throw new Error('Unknown project: ' + projectName);
  }
  return {
    SHEET_ID: MAIN_SHEET_ID,
    SHEET_NAME: PROJECTS[projectName].SHEET_NAME,
    API_URL: PROJECTS[projectName].API_URL,
    TARGET_EROAS: PROJECTS[projectName].TARGET_EROAS(),
    GROWTH_THRESHOLDS: PROJECTS[projectName].GROWTH_THRESHOLDS(),
    BEARER_TOKEN: PROJECTS[projectName].BEARER_TOKEN,
    COMMENTS_CACHE_SHEET: PROJECTS[projectName].COMMENTS_CACHE_SHEET
  };
}

function getProjectApiConfig(projectName) {
  if (!PROJECTS[projectName]) {
    throw new Error('Unknown project: ' + projectName);
  }
  return PROJECTS[projectName].API_CONFIG;
}

// Set current project
function setCurrentProject(projectName) {
  if (!PROJECTS[projectName]) {
    throw new Error('Unknown project: ' + projectName);
  }
  CURRENT_PROJECT = projectName;
}

// Legacy support - keep old CONFIG and API_CONFIG for backward compatibility
var CONFIG = getCurrentConfig();
var API_CONFIG = getCurrentApiConfig();

// Table configuration with updated column widths
var TABLE_CONFIG = {
  HEADERS: [
    'Level', 'Week Range / Source App', 'ID', 'GEO',
    'Spend', 'Spend WoW %', 'Installs', 'CPI', 'ROAS D-1', 'IPM',
    'eARPU 365d', 'eROAS 365d', 'eProfit 730d', 'eProfit 730d WoW %', 'Growth Status', 'Comments'
  ],
  COLUMN_WIDTHS: [
    { c: 1, w: 80 }, { c: 2, w: 300 }, { c: 3, w: 50 }, { c: 4, w: 50 }, { c: 5, w: 75 },
    { c: 6, w: 100 }, { c: 7, w: 75 }, { c: 8, w: 75 }, { c: 9, w: 75 }, { c: 10, w: 75 },      // Spend WoW % = 100
    { c: 11, w: 100 }, { c: 12, w: 120 }, { c: 13, w: 125 }, { c: 14, w: 100 }, { c: 15, w: 220 }, { c: 16, w: 200 }  // eProfit WoW % = 100, Growth Status = 220
  ]
};

// Formatting colors (same for all projects)
var COLORS = {
  HEADER: { background: '#4285f4', fontColor: 'white' },
  APP_ROW: { background: '#d1e7fe', fontColor: 'black' },
  WEEK_ROW: { background: '#e8f0fe' },
  CAMPAIGN_ROW: { background: '#ffffff' },
  POSITIVE: { background: '#d1f2eb', fontColor: '#0c5460' },
  NEGATIVE: { background: '#f8d7da', fontColor: '#721c24' },
  WARNING: { background: '#fff3cd', fontColor: '#856404' },
  INFO: { background: '#d1ecf1', fontColor: '#0c5460' }
};
