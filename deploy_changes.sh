#!/bin/bash

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ GAS –∏ GitHub
# –ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–¥–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç

CHANGE_SUMMARY="$1"

# –ï—Å–ª–∏ —Å–≤–æ–¥–∫–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
if [ -z "$CHANGE_SUMMARY" ]; then
    CHANGE_SUMMARY="Code updates via Claude Code"
fi

echo "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
echo "üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è: $CHANGE_SUMMARY"

# 1. –ü—É—à –Ω–∞ GAS —Å–µ—Ä–≤–µ—Ä
echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Google Apps Script..."
if clasp push --force; then
    echo "‚úÖ GAS: –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"
else
    echo "‚ùå GAS: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
if git diff-index --quiet HEAD --; then
    echo "‚ÑπÔ∏è  Git: –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
else
    echo "üìù Git: –ù–∞–π–¥–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    git add -A
    
    # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
    git commit -m "$CHANGE_SUMMARY

ü§ñ Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>"
    
    # –ü—É—à–∏–º –Ω–∞ GitHub
    echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub..."
    if git push origin main; then
        echo "‚úÖ GitHub: –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"
    else
        echo "‚ùå GitHub: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ"
        exit 1
    fi
fi

echo "üéâ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"